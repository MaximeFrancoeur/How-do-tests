<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>How-do-tests by MaximeFrancoeur</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">How-do-tests</h1>
      <h2 class="project-tagline">How do tests with Mockito.</h2>
      <a href="https://github.com/MaximeFrancoeur/How-do-tests" class="btn">View on GitHub</a>
      <a href="https://github.com/MaximeFrancoeur/How-do-tests/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/MaximeFrancoeur/How-do-tests/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="--how-do-tests-with-mockito" class="anchor" href="#--how-do-tests-with-mockito" aria-hidden="true"><span class="octicon octicon-link"></span></a>
<img src="https://raw.githubusercontent.com/MaximeFrancoeur/How-do-tests/master/img/mockito_logo.png" alt="Mockito logo">  How do tests with Mockito.</h1>

<h2>
<a id="this-page-is-under-construction" class="anchor" href="#this-page-is-under-construction" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>This page is under construction.</code>
</h2>

<h4>
<a id="1-add-dependency-in-your-project-maven" class="anchor" href="#1-add-dependency-in-your-project-maven" aria-hidden="true"><span class="octicon octicon-link"></span></a>1. Add dependency in your project Maven</h4>

<div class="highlight highlight-java"><pre><span class="pl-k">&lt;</span>dependency<span class="pl-k">&gt;</span>
    <span class="pl-k">&lt;</span>dependency<span class="pl-k">&gt;</span>
        <span class="pl-k">&lt;</span>groupId<span class="pl-k">&gt;</span>junit<span class="pl-k">&lt;</span><span class="pl-k">/</span>groupId<span class="pl-k">&gt;</span>
        <span class="pl-k">&lt;</span>artifactId<span class="pl-k">&gt;</span>junit<span class="pl-k">&lt;</span><span class="pl-k">/</span>artifactId<span class="pl-k">&gt;</span>
        <span class="pl-k">&lt;</span>version<span class="pl-k">&gt;</span><span class="pl-c1">4.12</span><span class="pl-k">&lt;</span><span class="pl-k">/</span>version<span class="pl-k">&gt;</span>
        <span class="pl-k">&lt;</span>scope<span class="pl-k">&gt;</span>test<span class="pl-k">&lt;</span><span class="pl-k">/</span>scope<span class="pl-k">&gt;</span>
    <span class="pl-k">&lt;</span><span class="pl-k">/</span>dependency<span class="pl-k">&gt;</span>
    <span class="pl-k">&lt;</span>dependency<span class="pl-k">&gt;</span>
        <span class="pl-k">&lt;</span>groupId<span class="pl-k">&gt;</span>org<span class="pl-k">.</span>mockito<span class="pl-k">&lt;</span><span class="pl-k">/</span>groupId<span class="pl-k">&gt;</span>
        <span class="pl-k">&lt;</span>artifactId<span class="pl-k">&gt;</span>mockito<span class="pl-k">-</span>core<span class="pl-k">&lt;</span><span class="pl-k">/</span>artifactId<span class="pl-k">&gt;</span>
        <span class="pl-k">&lt;</span>version<span class="pl-k">&gt;</span><span class="pl-c1">2.0</span><span class="pl-k">.</span><span class="pl-c1">7</span><span class="pl-k">-</span>beta<span class="pl-k">&lt;</span><span class="pl-k">/</span>version<span class="pl-k">&gt;</span>
    <span class="pl-k">&lt;</span><span class="pl-k">/</span>dependency<span class="pl-k">&gt;</span>
    <span class="pl-k">&lt;</span>dependency<span class="pl-k">&gt;</span>
        <span class="pl-k">&lt;</span>groupId<span class="pl-k">&gt;</span>javax<span class="pl-k">.</span>inject<span class="pl-k">&lt;</span><span class="pl-k">/</span>groupId<span class="pl-k">&gt;</span>
        <span class="pl-k">&lt;</span>artifactId<span class="pl-k">&gt;</span>javax<span class="pl-k">.</span>inject<span class="pl-k">&lt;</span><span class="pl-k">/</span>artifactId<span class="pl-k">&gt;</span>
        <span class="pl-k">&lt;</span>version<span class="pl-k">&gt;</span><span class="pl-c1">1</span><span class="pl-k">&lt;</span><span class="pl-k">/</span>version<span class="pl-k">&gt;</span>
    <span class="pl-k">&lt;</span><span class="pl-k">/</span>dependency<span class="pl-k">&gt;</span>
<span class="pl-k">&lt;</span><span class="pl-k">/</span>dependency<span class="pl-k">&gt;</span></pre></div>

<h4>
<a id="2-create-a-test-class" class="anchor" href="#2-create-a-test-class" aria-hidden="true"><span class="octicon octicon-link"></span></a>2. Create a test Class</h4>

<p>In Intellij open a Class and the shortcut to create a test Class is. : <code>CTRL + shift + t</code></p>

<ul>
<li>Select Junit4</li>
<li>Check setUp /<a href="https://github.com/Before" class="user-mention">@Before</a>
</li>
<li>Check All the methods you want to test.</li>
</ul>

<p align="center">
<img align="center" src="https://raw.githubusercontent.com/MaximeFrancoeur/How-do-tests/master/img/create_test.png" alt="Create test">
</p>

<ul>
<li>Annote your Class test with @RunWith(MockitoJUnitRunner.class)</li>
<li>Add @InjectMocks on Class test</li>
<li>Add <a href="https://github.com/Mock" class="user-mention">@Mock</a> on all Class mock</li>
<li>Add <a href="https://github.com/Before" class="user-mention">@Before</a> and init annotations</li>
</ul>

<div class="highlight highlight-java"><pre><span class="pl-c">// Example service</span>
<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">MyServiceImpl</span> <span class="pl-k">implements</span> <span class="pl-e">MyService</span> {

    <span class="pl-k">@Inject</span>
    <span class="pl-k">private</span> <span class="pl-smi">MyRepositoryDAO</span> myRepositoryDAO;

    <span class="pl-k">public</span> <span class="pl-smi">Foo</span> <span class="pl-en">testExample</span>(<span class="pl-k">final</span> <span class="pl-smi">Integer</span> <span class="pl-v">id</span>) <span class="pl-k">throws</span> <span class="pl-smi">Exception</span> {
        <span class="pl-c1">...</span>
    }
}

<span class="pl-c">// Example class test</span>
@RunWith(<span class="pl-smi">MockitoJUnitRunner</span><span class="pl-k">.</span>class)
<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">MyServiceImplTest</span> {

    <span class="pl-k">@InjectMocks</span>
    <span class="pl-k">private</span> <span class="pl-smi">MyServiceImpl</span> myService;

    <span class="pl-k">@Mock</span>
    <span class="pl-k">private</span> <span class="pl-smi">MyRepositoryDAO</span> myRepositoryDAO;

    <span class="pl-k">@Before</span>
    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">setUp</span>() <span class="pl-k">throws</span> <span class="pl-smi">Exception</span> {
        <span class="pl-smi">MockitoAnnotations</span><span class="pl-k">.</span>initMocks(<span class="pl-v">this</span>);
    }

    <span class="pl-k">@Test</span>
    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">testExample</span>() <span class="pl-k">throws</span> <span class="pl-smi">Exception</span> {
        <span class="pl-c1">...</span>
    }

}</pre></div>

<h4>
<a id="3-what-test" class="anchor" href="#3-what-test" aria-hidden="true"><span class="octicon octicon-link"></span></a>3. What test?</h4>

<p>I have a service to test with his methods. I should do what test to cover the largest number of cases?</p>

<div class="highlight highlight-java"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">MyServiceImpl</span> <span class="pl-k">implements</span> <span class="pl-e">MyService</span> {

    <span class="pl-k">@Inject</span>
    <span class="pl-k">private</span> <span class="pl-smi">MyRepositoryDAO</span> myRepositoryDAO;

    <span class="pl-k">public</span> <span class="pl-smi">Foo</span> <span class="pl-en">getById</span>(<span class="pl-k">final</span> <span class="pl-smi">Integer</span> <span class="pl-v">id</span>) <span class="pl-k">throws</span> <span class="pl-smi">Exception</span> {

        <span class="pl-c">// 1. Test if id is null : expected Exception</span>
        <span class="pl-k">if</span> (id <span class="pl-k">==</span> <span class="pl-c1">null</span>) {
            <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-smi">Exception</span>();
        }

        <span class="pl-c">// 2. Test whether the argument is passed to the DAO.</span>
        <span class="pl-k">final</span> <span class="pl-smi">Foo</span> foo <span class="pl-k">=</span> myRepositoryDAO<span class="pl-k">.</span>getById(id);

        <span class="pl-c">// 3. Test if foo is null : expected Exception</span>
        <span class="pl-k">if</span> (foo <span class="pl-k">==</span> <span class="pl-c1">null</span>) {
            <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-smi">Exception</span>();
        }

        <span class="pl-c">// 4. Finally a test with no error.</span>
        <span class="pl-k">return</span> foo;
    }

    <span class="pl-k">public</span> <span class="pl-k">List&lt;<span class="pl-smi">Foo</span>&gt;</span> <span class="pl-en">findByName</span>(<span class="pl-k">final</span> <span class="pl-smi">String</span> <span class="pl-v">name</span>) <span class="pl-k">throws</span> <span class="pl-smi">Exception</span> {

        <span class="pl-c">// 1. Test if name is null : expected Exception</span>
        <span class="pl-c">// 2. Test if name is not null but empty ("") : expected Exception</span>
        <span class="pl-k">if</span> (name <span class="pl-k">==</span> <span class="pl-c1">null</span> <span class="pl-k">||</span> name<span class="pl-k">.</span>equals(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>)) {
            <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-smi">Exception</span>();
        }

        <span class="pl-c">// 3. Test whether the argument is passed to the DAO.</span>
        <span class="pl-k">final</span> <span class="pl-k">List&lt;<span class="pl-smi">Foo</span>&gt;</span> foo <span class="pl-k">=</span> myRepositoryDAO<span class="pl-k">.</span>findByName(name);

        <span class="pl-c">// 4. Test if foo is null : excepted ArraysList empty</span>
        <span class="pl-k">if</span> (foo <span class="pl-k">==</span> <span class="pl-c1">null</span>) {
            <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-k">ArrayList&lt;<span class="pl-smi">Foo</span>&gt;</span>();
        }

        <span class="pl-c">// 5. Finally a test with no error.</span>
        <span class="pl-k">return</span> foo;
    }

    <span class="pl-k">public</span> <span class="pl-smi">Foo</span> <span class="pl-en">updateFoo</span>(<span class="pl-smi">Foo</span> <span class="pl-v">foo</span>) <span class="pl-k">throws</span> <span class="pl-smi">Exception</span> {

        <span class="pl-c">// 1. Test if foo is null : expected Exception</span>
        <span class="pl-c">// 2. Test if foo is not null but if id is null : expected Exception</span>
        <span class="pl-k">if</span> (foo <span class="pl-k">==</span> <span class="pl-c1">null</span> <span class="pl-k">||</span> foo<span class="pl-k">.</span>getId() <span class="pl-k">==</span> <span class="pl-c1">null</span>) {
            <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-smi">Exception</span>();
        }

        <span class="pl-c">// 3. Test if lastModifiedDate is modified.</span>
        foo<span class="pl-k">.</span>setLastModifiedDate(<span class="pl-k">new</span> <span class="pl-smi">Date</span>());

        <span class="pl-c">// 4. Finally a test with no error.</span>
        <span class="pl-k">return</span> myRepositoryDAO<span class="pl-k">.</span>updateFoo(foo);
    }
}</pre></div>

<hr>

<h4>
<a id="getid" class="anchor" href="#getid" aria-hidden="true"><span class="octicon octicon-link"></span></a>GetId()</h4>

<p>#1 Test if id is null : expected Exception</p>

<div class="highlight highlight-java"><pre>@Test(expected <span class="pl-k">=</span> <span class="pl-smi">Exception</span><span class="pl-k">.</span>class)
 <span class="pl-k">public</span> <span class="pl-k">void</span> getById_nullId() throws <span class="pl-smi">Exception</span> {
     myService<span class="pl-k">.</span>getById(<span class="pl-c1">null</span>);
 }</pre></div>

<p>#3 Test whether the argument is passed to the DAO.</p>

<div class="highlight highlight-java"><pre>@Test(expected <span class="pl-k">=</span> <span class="pl-smi">Exception</span><span class="pl-k">.</span>class)
<span class="pl-k">public</span> <span class="pl-k">void</span> getById_daoReturnNull() throws <span class="pl-smi">Exception</span> {

   <span class="pl-smi">Mockito</span><span class="pl-k">.</span>when(myRepositoryDAO<span class="pl-k">.</span>getById(<span class="pl-smi">Mockito</span><span class="pl-k">.</span>eq(<span class="pl-c1">1</span>)))<span class="pl-k">.</span>thenReturn(<span class="pl-c1">null</span>);

   myService<span class="pl-k">.</span>getById(<span class="pl-c1">1</span>);
}</pre></div>

<p>#4 Finally a test with no error. And #2 test whether the argument is passed to the DAO.</p>

<div class="highlight highlight-java"><pre>@<span class="pl-smi">Test</span>
<span class="pl-k">public</span> <span class="pl-k">void</span> getById() throws <span class="pl-smi">Exception</span> {

   <span class="pl-k">final</span> <span class="pl-smi">Date</span> date <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">Date</span>();

   <span class="pl-k">final</span> <span class="pl-k">List&lt;<span class="pl-smi">String</span>&gt;</span> list <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-k">ArrayList&lt;<span class="pl-smi">String</span>&gt;</span>();
   list<span class="pl-k">.</span>add(<span class="pl-s"><span class="pl-pds">"</span>1<span class="pl-pds">"</span></span>);
   list<span class="pl-k">.</span>add(<span class="pl-s"><span class="pl-pds">"</span>2<span class="pl-pds">"</span></span>);
   list<span class="pl-k">.</span>add(<span class="pl-s"><span class="pl-pds">"</span>3<span class="pl-pds">"</span></span>);

   <span class="pl-k">final</span> <span class="pl-smi">Foo</span> foo <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">Foo</span>();
   foo<span class="pl-k">.</span>setId(<span class="pl-c1">1</span>);
   foo<span class="pl-k">.</span>setLastModifiedDate(date);
   foo<span class="pl-k">.</span>setName(<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>);
   foo<span class="pl-k">.</span>setList(list);

<span class="pl-c">// Check if myRepository is called with 1 and returned my object foo</span>
   <span class="pl-smi">Mockito</span><span class="pl-k">.</span>when(myRepositoryDAO<span class="pl-k">.</span>getById(<span class="pl-smi">Mockito</span><span class="pl-k">.</span>eq(<span class="pl-c1">1</span>)))<span class="pl-k">.</span>thenReturn(foo);

   <span class="pl-k">final</span> <span class="pl-smi">Foo</span> result <span class="pl-k">=</span> myService<span class="pl-k">.</span>getById(<span class="pl-c1">1</span>);

   <span class="pl-smi">Assert</span><span class="pl-k">.</span>assertEquals(<span class="pl-smi">Integer</span><span class="pl-k">.</span>valueOf(<span class="pl-c1">1</span>), result<span class="pl-k">.</span>getId());
   <span class="pl-smi">Assert</span><span class="pl-k">.</span>assertEquals(date, result<span class="pl-k">.</span>getLastModifiedDate());
   <span class="pl-smi">Assert</span><span class="pl-k">.</span>assertEquals(<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>, result<span class="pl-k">.</span>getName());
   <span class="pl-smi">Assert</span><span class="pl-k">.</span>assertEquals(<span class="pl-smi">Integer</span><span class="pl-k">.</span>valueOf(<span class="pl-c1">3</span>), <span class="pl-smi">Integer</span><span class="pl-k">.</span>valueOf(result<span class="pl-k">.</span>getList()<span class="pl-k">.</span>size()));

   <span class="pl-c">// two lists are defined to be equal if they contain the same elements in the same order.</span>
   <span class="pl-smi">Assert</span><span class="pl-k">.</span>assertEquals(list, result<span class="pl-k">.</span>getList());
}</pre></div>

<h4>
<a id="4-how-mock-private-methode-" class="anchor" href="#4-how-mock-private-methode-" aria-hidden="true"><span class="octicon octicon-link"></span></a>4. How mock private methode ?</h4>

<h4>
<a id="5-how-captor-a-property-" class="anchor" href="#5-how-captor-a-property-" aria-hidden="true"><span class="octicon octicon-link"></span></a>5. How captor a property ?</h4>

<h4>
<a id="6-how-spy-a-methode-" class="anchor" href="#6-how-spy-a-methode-" aria-hidden="true"><span class="octicon octicon-link"></span></a>6. How spy a methode ?</h4>

<h4>
<a id="7-run-test-with-covrage-in-intellij" class="anchor" href="#7-run-test-with-covrage-in-intellij" aria-hidden="true"><span class="octicon octicon-link"></span></a>7. Run test with covrage in Intellij</h4>

<p>To run the tests with Intellij, you only have to click right on the Class or the Class has an external method if you click in a way only this test method will be run.</p>

<p align="center">
<img align="center" src="https://raw.githubusercontent.com/MaximeFrancoeur/How-do-tests/master/img/right_click.png" alt="Run test with coverage">
</p><p>

</p><p>
After your test is finished, you can go into the Class or that you have tested. And look to your left. You will see green and red bars may be darker than me because I changed the configuration in Intellij gluer.
</p>

<ul>
<li>The green bar means that one or tests are spent on its lines.</li>
<li>The red bar means that no test cases have passed through his lines of code.</li>
</ul>

<p align="center">
<img align="center" src="https://raw.githubusercontent.com/MaximeFrancoeur/How-do-tests/master/img/covrage.png" alt="coverage">
</p>

<p><br>
You can click the green bars to view the number of times that his line was covered by your tests.</p>

<p align="center">
<img align="center" src="https://raw.githubusercontent.com/MaximeFrancoeur/How-do-tests/master/img/left_click_covrage.png" alt="Number hits">
</p>

<p><br>
At the bottom right of your Intellij you your new option appear.
Click above to see the percentage of power line method and hedged Class.</p>

<p align="center">
<img align="center" src="https://raw.githubusercontent.com/MaximeFrancoeur/How-do-tests/master/img/icon_covrage_right.png" alt="New icon coverage">
</p>

<p><br>
Click in the packages you want to go and watch the number of percentage cover your project.</p>

<p align="center">
<img align="center" src="https://raw.githubusercontent.com/MaximeFrancoeur/How-do-tests/master/img/covrage_detail.png" alt="All coverage">
</p>

<h4>
<a id="8-how-test-dao-with-flyway-" class="anchor" href="#8-how-test-dao-with-flyway-" aria-hidden="true"><span class="octicon octicon-link"></span></a>8. How test DAO with Flyway ?</h4>

<ul>
<li>Create Flyway config</li>
<li>Create Flyway insert data</li>
</ul>

<h4>
<a id="9-how-test-controller-" class="anchor" href="#9-how-test-controller-" aria-hidden="true"><span class="octicon octicon-link"></span></a>9. How test Controller ?</h4>

<h4>
<a id="10-best-practice" class="anchor" href="#10-best-practice" aria-hidden="true"><span class="octicon octicon-link"></span></a>10. Best practice</h4>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/MaximeFrancoeur/How-do-tests">How-do-tests</a> is maintained by <a href="https://github.com/MaximeFrancoeur">MaximeFrancoeur</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>

